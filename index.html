
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Revo API Factoring Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;ruby--tab&quot;,&quot;java&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="ruby--tab">Ruby</a>
              <a href="#" data-language-name="java">Java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#3394112aa9" class="toc-h1 toc-link" data-title="">Введение</a>
          </li>
          <li>
            <a href="#93900fccba" class="toc-h1 toc-link" data-title="">Авторизация</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#url" class="toc-h2 toc-link" data-title="url">Базовые URL адреса</a>
                  </li>
                  <li>
                    <a href="#3b61794258" class="toc-h2 toc-link" data-title="">Параметры авторизации</a>
                  </li>
                  <li>
                    <a href="#1c37860b3b" class="toc-h2 toc-link" data-title="">Принцип формирования цифровой подписи</a>
                  </li>
                  <li>
                    <a href="#1cb46d0fab" class="toc-h2 toc-link" data-title="">Принципиальная схема взаимодействия</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#api" class="toc-h1 toc-link" data-title="api">Методы API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#registration" class="toc-h2 toc-link" data-title="registration">Registration</a>
                  </li>
                  <li>
                    <a href="#limit" class="toc-h2 toc-link" data-title="limit">Limit</a>
                  </li>
                  <li>
                    <a href="#checkout" class="toc-h2 toc-link" data-title="checkout">Checkout</a>
                  </li>
                  <li>
                    <a href="#schedule" class="toc-h2 toc-link" data-title="schedule">Schedule</a>
                  </li>
                  <li>
                    <a href="#status" class="toc-h2 toc-link" data-title="status">Status</a>
                  </li>
                  <li>
                    <a href="#change" class="toc-h2 toc-link" data-title="change">Change</a>
                  </li>
                  <li>
                    <a href="#cancel" class="toc-h2 toc-link" data-title="cancel">Cancel</a>
                  </li>
                  <li>
                    <a href="#finish" class="toc-h2 toc-link" data-title="finish">Finish</a>
                  </li>
                  <li>
                    <a href="#return" class="toc-h2 toc-link" data-title="return">Return</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cb76858662" class="toc-h1 toc-link" data-title="">Коды ошибок</a>
          </li>
          <li>
            <a href="#iframe-revo" class="toc-h1 toc-link" data-title="iframe-revo">Описание iFrame REVO</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#c5a67eacd9" class="toc-h2 toc-link" data-title="">Регистрация клиента</a>
                  </li>
                  <li>
                    <a href="#c3d3aac3a6" class="toc-h2 toc-link" data-title="">Авторизация клиента</a>
                  </li>
                  <li>
                    <a href="#ee363a7d6e" class="toc-h2 toc-link" data-title="">Оформление покупки</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#5a291e242a" class="toc-h1 toc-link" data-title="">Представление на сайте</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#iframe" class="toc-h2 toc-link" data-title="iframe">Вызов iFrame</a>
                  </li>
                  <li>
                    <a href="#818f499a59" class="toc-h2 toc-link" data-title="">Отображение доступного лимита</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#db947828e5" class="toc-h1 toc-link" data-title="">Тестирование и отладка</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#afed7bf690" class="toc-h2 toc-link" data-title="">Тестовые Параметры</a>
                  </li>
                  <li>
                    <a href="#16d7f57449" class="toc-h2 toc-link" data-title="">Инструкции для тестирования</a>
                  </li>
                  <li>
                    <a href="#b7617b8769" class="toc-h2 toc-link" data-title="">Кейсы для тестирования</a>
                  </li>
                  <li>
                    <a href="#ad57058c12" class="toc-h2 toc-link" data-title="">Особенности</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://revo.ru/'>Revo.ru</a></li>
            <li><a href='https://revotechnology.github.io/api-factoring-eng/'>API Documentation in English</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='3394112aa9'>Введение</h1>
<p>API Factoring реализовано на протоколе HTTPS на основе JSON запросов.</p>

<p>Документация состоит из следующих основных частей:</p>

<ul>
<li>Описание авторизации, <a href="#api">методов API</a> и <a href="#cb76858662"> кодов ошибок</a>.</li>
<li><a href="#iframe-revo">Описание iFrame Мокка</a>.</li>
<li><a href="#5a291e242a">Представление сервиса Мокка на сайте</a>.</li>
<li><a href="#db947828e5">Руководство по тестированию</a>.</li>
</ul>
<h1 id='93900fccba'>Авторизация</h1><h2 id='url'>Базовые URL адреса</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s2">"https://r.revo.ru"</span>
<span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s2">"https://backend.demo.revoup.ru"</span>
</code></pre>
<ol>
<li>Для взаимодействия с сервисами Мокка используются 2 базовых адреса:

<ul>
<li>https://r.revo.ru - адрес <code>production</code> сервиса.</li>
<li>https://backend.demo.revoup.ru - адрес <code>demo</code> сервиса.</li>
</ul></li>
<li><code>BASE_URL</code> - переменная обозначающая базовый адрес.</li>
</ol>

<aside class="notice">
Подключение должно производиться только по протоколу HTTPS  - при попытке подключения по HTTP будет возникать 404 ошибка.
</aside>
<h2 id='3b61794258'>Параметры авторизации</h2>
<blockquote>
<p>Пример параметров</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">secret_key</span> <span class="o">=</span> <span class="s2">"098f6bcd4621d373cade4e832627b4f6"</span>
<span class="nx">STORE_ID</span> <span class="o">=</span> <span class="mi">123</span>
</code></pre>
<ol>
<li>На стороне Мокка формируются уникальный идентификатор магазина и секретный ключ, которые передаются партнеру:

<ul>
<li><code>store_id</code> - уникальный идентификатор магазина. Для одного партнера может быть сформировано несколько уникальных идентификаторов.</li>
<li><code>secret_key</code> - секретный ключ, который используется при формировании электронно-цифровой подписи для аутентификации (проверки подлинности) параметров запроса с целью защиты формы от запуска сторонними лицами. Длина ключа от 8 байт. Алгоритм шифрования SHA1.</li>
</ul></li>
<li>Для авторизации партнер отправляет <code>POST</code> запрос, используя <a href="#1c37860b3b">цифровую подпись</a> <code>signature</code> и уникальный идентификатор магазина <code>store_id</code>.</li>
<li>Примеры URL запросов можно посмотреть в разделе <a href="#api"> Методы API</a>.</li>
</ol>
<h2 id='1c37860b3b'>Принцип формирования цифровой подписи</h2>
<blockquote>
<p>Алгоритм формирования цифровой подписи</p>
</blockquote>
<pre class="highlight ruby tab-ruby--tab"><code><span class="nb">require</span> <span class="s1">'digest/sha1'</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="s1">'9fff8c602b08b00323567be0001480f6'</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">order_id</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">FACTPRECHR152632</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">amount</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">8300.00</span><span class="se">\"</span><span class="s2">}"</span>
<span class="no">SIGNATURE</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">SHA1</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">secret_key</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Результатом шифрования в примере выше будет являться строка &quot;cbfb21630cd585f59c3a50fc3365d8c26b97cd4e&quot;.</p>
</blockquote>
<pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Formatter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="n">String</span> <span class="n">secret_key</span> <span class="o">=</span> <span class="s">"098f6bcd4621d373cade4e832627b4f6"</span><span class="o">;</span> <span class="c1">// Это пример</span>
    <span class="kd">static</span> <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{\"callback_url\":\"https://shop.ru/revo/decision\",\"redirect_url\":\"https://shop.ru/revo/redirect\",\"current_order\":{\"amount\":\"7500.00\",\"order_id\":\"R001233\"},\"primary_phone\":\"9268180621\"}"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">encryptPassword</span><span class="o">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">secret_key</span><span class="o">);</span> <span class="c1">// Тут всегда будет 40 символов по SHA1</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">signature</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encryptPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">sha1</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">MessageDigest</span> <span class="n">crypt</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"SHA-1"</span><span class="o">);</span>
            <span class="n">crypt</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
            <span class="n">crypt</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">));</span>
            <span class="n">sha1</span> <span class="o">=</span> <span class="n">byteToHex</span><span class="o">(</span><span class="n">crypt</span><span class="o">.</span><span class="na">digest</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">NoSuchAlgorithmException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sha1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">byteToHex</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hash</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Formatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Formatter</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="o">:</span> <span class="n">hash</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">formatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%02x"</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">formatter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Тело json запроса экранируется (ставится <code>\</code> перед символами <code>&quot;</code> и <code>\</code>) и к строке <code>data</code> добавляется секретный ключ <code>secret_key</code>. К получившейся строке применяется алгоритм SHA1, в результате формируется цифровая подпись <code>signature</code>.</p>

<aside class="notice">
Необходимо обратить внимание, что при формировании signature длина всегда будет 40 символов по SHA1.
</aside>
<h2 id='1cb46d0fab'>Принципиальная схема взаимодействия</h2>
<blockquote>
<p><a href="Diagram.png" target="new"><img src="Diagram.png"></a></p>
</blockquote>

<p>Расчёт доступной клиенту для оплаты частями суммы производится с помощью метода <a href="#registration">Registration</a>, который возвращает ссылку на iFrame Мокка. Клиент проходит процедуру регистрации в iFrame Мокка, после чего в callback передаётся информация о результате: одобрение или отказ в лимите (доступной для оплаты частями сумме).</p>

<p>Оформление покупки совершается аналогичным образом с помощью метода <a href="#registration">Checkout</a>, который возвращает ссылку на iFrame Мокка, но уже с большим числом шагов. После регистрации (или авторизации) клиента, появляется шаг с выбором графика платежей. После оформления клиентом заказа денежные средства блокируются на счете клиента, заявка переводится в статус <code>hold</code>, решение по клиенту и сумма также возвращается в callback.</p>

<p>Для окончательного оформления и подтверждения заявки необходимо ее финализировать с помощью метода <a href="#finish">Finish</a>. Принципиальная схема процесса представлена на диаграмме справа.</p>
<h1 id='api'>Методы API</h1><h2 id='registration'>Registration</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">limit</span><span class="o">/</span><span class="n">auth?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод возвращает ссылку на iFrame для получения лимита. По завершению формы на адрес указанный в <code>callback_url</code> отправляется <a href="#callback_url2">json ответ</a> с результатом решения по лимиту клиента.</p>

<p>В зависимости от информации, которая есть о пользователе в системе Мокка, форма будет иметь различное число шагов (для этого нужно передавать <code>primary_phone</code>) - см. подробнее <a href="#iframe-revo">Описание iFrame REVO</a>.</p>

<aside class="success">
Если клиент уже заполнял личные данные на сайте партнёра, их следует передать в запросе для автозаполнения соответствующих полей формы.
</aside>
<h3 id='parameters'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"callback_url"</span><span class="p">:</span> <span class="s">"https://shop.ru/revo/decision"</span><span class="p">,</span>
  <span class="s">"redirect_url"</span><span class="p">:</span> <span class="s">"https://shop.ru/revo/redirect"</span><span class="p">,</span>
  <span class="s">"primary_phone"</span><span class="p">:</span> <span class="s">"9268180621"</span><span class="p">,</span>
  <span class="s">"primary_email"</span><span class="p">:</span> <span class="s">"ivan@gmail.com"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R001233"</span>
  <span class="p">},</span>
  <span class="s">"person"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="s">"Петр"</span><span class="p">,</span>
    <span class="s">"surname"</span><span class="p">:</span> <span class="s">"Чернышев"</span><span class="p">,</span>
    <span class="s">"patronymic"</span><span class="p">:</span> <span class="s">"Александрович"</span><span class="p">,</span>
    <span class="s">"birth_date"</span><span class="p">:</span> <span class="s">"15.01.1975"</span>
  <span class="p">},</span>
  <span class="s">"additional_data"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"previous_url"</span><span class="p">:</span> <span class="s">"https://revo.ru/where-to-buy"</span><span class="p">,</span>
    <span class="s">"channel"</span><span class="p">:</span> <span class="s">"mobile"</span><span class="p">,</span>
    <span class="s">"returning_customer"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"bank_card"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"last_orders"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span>
    <span class="s">"same_address"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>callback_url</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> URL для ответа от Мокка по решению для клиента.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>redirect_url</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> URL для редиректа после нажатия на кнопку/ссылку в форме Мокка &quot;Вернуться в интернет магазин&quot;.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>current_order</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о заказе.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов. Можно использовать уникальную случайную строку.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>primary_phone</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>primary_email</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Email клиента.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>person</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>first_name</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Имя клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>surname</strong><br> <font color="#939da3">sring, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Фамилия клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>patronymic</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Отчество клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>birth_date</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Дата рождения клиента в формате <code>dd.mm.yyyy</code>.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>additional_data</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Объект для передачи дополнительной информации о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>previous_url</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Адрес, откуда клиент зашёл на сайт партнёра.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>channel</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">В каком канале открыта форма. Возможные значения: <code>mobile</code>, <code>app</code>, <code>desktop</code>.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>returning_customer</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Является ли клиент повторным для партнёра.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>bank_card</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Является ли последним способом оплаты банковская карта.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>last_orders</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Количество заказов за последние 6 мес.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>same_address</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Совпадает ли текущий адрес доставки с предыдущим адресом доставки.</td>
</tr>
</tbody></table>
<h3 id='response-parameters'>Response Parameters</h3>
<blockquote>
<p>Пример ответа для успешной аутентификации.</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"iframe_url"</span><span class="p">:</span> <span class="s">"https://r.revoup.ru/form/v1/af45ef12f4233f"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left">Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Короткое текстовое описание ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>iframe_url</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Cсылка на сгенерированный iFrame.</td>
</tr>
</tbody></table>

<p><a name="callback_url"></a></p>
<h3 id='callback-parameters'>callback parameters</h3>
<blockquote>
<p>Пример callback-а при успешном завершении формы:</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"32423"</span><span class="p">,</span>
  <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mf">5000.00</span><span class="p">,</span>
  <span class="s">"mobile_phone"</span><span class="p">:</span> <span class="s">"89262341793"</span><span class="p">,</span>
  <span class="s">"email"</span><span class="p">:</span> <span class="s">"ivan@gmail.com"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов.</td>
</tr>
<tr>
<td style="text-align: right"><strong>decision</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Решение по выдаче рассрочки. При положительном решении - значение <code>approved</code> (заявка ожидает финализации). При отрицательном решении - <code>declined</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: left">Сумма в рублях.</td>
</tr>
<tr>
<td style="text-align: right"><strong>mobile_phone</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
<tr>
<td style="text-align: right"><strong>email</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Email клиента.</td>
</tr>
</tbody></table>

<aside class="success">
При `decision` равном `declined` значение `amount` будет нулевое.
</aside>
<h3 id='7153adaedf'>Упрощенный вызов формы регистрации клиента</h3>
<p>Данный способ позволяет напрямую по ссылке вызывать <a href="#c5a67eacd9">iframe</a> для регистрации клиента.</p>

<p>Ссылка для вызова формы:
<code>https://{BASE_URL}/iframe/v2/limit_form/{uid}</code></p>

<ul>
<li>BASE_URL можно посмотреть в разделе Авторизация &gt; <a href="#url">Базовые URL адреса</a></li>
<li>В разделе Представление на сайте &gt; <a href="#iframe">Вызов iframe</a> можно посмотреть, как вызывать форму в pop-up</li>
<li>В UID указывается идентификатор партнера, который предоставляет Мокка</li>
</ul>
<h2 id='limit'>Limit</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">external</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">limit?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод для получения суммы лимита клиента по номеру его телефона. Для новых клиентов получить информацию о лимите только по номеру телефона нельзя.</p>
<h3 id='parameters-2'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"client"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"mobile_phone"</span><span class="p">:</span> <span class="s">"9031234567"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>client</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left">Объект, содержащий информацию о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><strong>mobile_phone</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
</tbody></table>
<h3 id='response-parameters-2'>Response Parameters</h3>
<blockquote>
<p>Пример ответа, когда клиент найден в базе</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"meta"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span>
  <span class="p">},</span>
  <span class="s">"client"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"mobile_phone"</span><span class="p">:</span> <span class="s">"9031234567"</span><span class="p">,</span>
    <span class="s">"limit_amount"</span><span class="p">:</span> <span class="s">"9500.00"</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"active"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда клиент найден в базе, но выдача займа невозможна</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"meta"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span>
  <span class="p">},</span>
  <span class="s">"client"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"mobile_phone"</span><span class="p">:</span> <span class="s">"9031234567"</span><span class="p">,</span>
    <span class="s">"limit_amount"</span><span class="p">:</span> <span class="s">"6700.00"</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"inactive"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда клиент не найден в базе</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"meta"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span>
  <span class="p">},</span>
  <span class="s">"client"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"mobile_phone"</span><span class="p">:</span> <span class="s">"9031234567"</span><span class="p">,</span>
    <span class="s">"limit_amount"</span><span class="p">:</span> <span class="s">"0.00"</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"new"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left"><td colspan="2"> Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Короткое текстовое описание ответа.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>client</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>mobile_phone</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>limit_amount</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Лимит средств, доступных клиенту, в рублях.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>status</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Статус пользователя. Возможные значения:<br><code>active</code> - пользователю доступна услуга оплаты частями на сумму <code>limit_amount</code>;<br><code>inactive</code> - пользователю не доступна услуга оплаты частями;<br><code>new</code> - новый пользователь, которому доступна услуга оплаты частями на сумму <code>limit_amount</code>.</td>
</tr>
</tbody></table>
<h2 id='checkout'>Checkout</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">precheck</span><span class="o">/</span><span class="n">auth?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод возвращает ссылку на iFrame для оформления заказа клиента. По завершению формы на адрес указанный в <code>callback_url</code> отправляется <a href="#callback_url">json ответ</a> с результатом оформления. В случае успешного оформления, средства в размере <code>amount</code> холдируются на счёте клиента в системе Мокка.</p>

<p>В зависимости от информации, которая есть о пользователе в системе Мокка, форма будет иметь различное число шагов (для этого нужно передавать <code>primary_phone</code>) - см. <a href="#iframe-revo">Описание iFrame REVO</a>.</p>

<p>Для бизнес-моделей, где клиенту необходимо осуществлять предоплату, метод поддерживает 2 способа предоплаты:</p>

<ul>
<li><p>Если предоплата осуществлена до вызова iFrame, то информацию о ней необходимо передавать в <code>prepayment_amount</code>.</p></li>
<li><p>Если предоплата должна быть осуществлена после вызова iFrame, то производится соответствующая настройка на стороне Мокка. При этом следует параметр <code>skip_result_page</code> выставлять как <code>true</code> и передавать в <code>redirect_url</code> адрес страницы предоплаты, на которую будет перенаправлен клиент по завершению оформления в iFrame.</p></li>
</ul>

<aside class="success">
Если клиент уже заполнял личные данные на сайте партнёра, их следует передать в запросе для автозаполнения соответствующих полей формы.
</aside>
<h3 id='parameters-3'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"callback_url"</span><span class="p">:</span> <span class="s">"https://shop.ru/revo/decision"</span><span class="p">,</span>
  <span class="s">"redirect_url"</span><span class="p">:</span> <span class="s">"https://shop.ru/revo/redirect"</span><span class="p">,</span>
  <span class="s">"primary_phone"</span><span class="p">:</span> <span class="s">"9268180621"</span><span class="p">,</span>
  <span class="s">"primary_email"</span><span class="p">:</span> <span class="s">"ivan@gmail.com"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R001233"</span><span class="p">,</span>
    <span class="s">"valid_till"</span><span class="p">:</span> <span class="s">"21.07.2018 12:08:01+03:00"</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">"59499.00"</span><span class="p">,</span>
    <span class="s">"prepayment_amount"</span><span class="p">:</span> <span class="mf">"1000.00"</span>
  <span class="p">},</span>
  <span class="s">"person"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="s">"Петр"</span><span class="p">,</span>
    <span class="s">"surname"</span><span class="p">:</span> <span class="s">"Чернышев"</span><span class="p">,</span>
    <span class="s">"patronymic"</span><span class="p">:</span> <span class="s">"Александрович"</span><span class="p">,</span>
    <span class="s">"birth_date"</span><span class="p">:</span> <span class="s">"15.01.1975"</span>
  <span class="p">},</span>
  <span class="s">"cart_items"</span><span class="p">:</span>
  <span class="p">[{</span>
    <span class="s">"sku"</span><span class="p">:</span> <span class="s">"1231"</span><span class="p">,</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Samsung Note 8"</span><span class="p">,</span>
    <span class="s">"price"</span><span class="p">:</span> <span class="mi">55999</span><span class="p">,</span>
    <span class="s">"quantity"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"unit"</span><span class="p">:</span> <span class="s">"шт."</span><span class="p">,</span>
    <span class="s">"brand"</span><span class="p">:</span> <span class="s">"Samsung"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s">"sku"</span><span class="p">:</span> <span class="s">"23543"</span><span class="p">,</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Чехол фирменный"</span><span class="p">,</span>
    <span class="s">"price"</span><span class="p">:</span> <span class="mi">3500</span><span class="p">,</span>
    <span class="s">"sale_price"</span><span class="p">:</span> <span class="mi">2999</span><span class="p">,</span>
    <span class="s">"quantity"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"unit"</span><span class="p">:</span> <span class="s">"шт."</span><span class="p">,</span>
    <span class="s">"brand"</span> <span class="p">:</span> <span class="s">"Samsung"</span><span class="p">,</span>
    <span class="s">"category"</span><span class="p">:</span> <span class="s">"Accessories"</span>
  <span class="p">}],</span>
  <span class="s">"skip_result_page"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s">"delivery_info"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="s">"Петр"</span><span class="p">,</span>
    <span class="s">"surname"</span><span class="p">:</span> <span class="s">"Чернышев"</span><span class="p">,</span>
    <span class="s">"patronymic"</span><span class="p">:</span> <span class="s">"Александрович"</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"Pickpoint"</span><span class="p">,</span>
    <span class="s">"address"</span><span class="p">:</span> <span class="s">"ул. Ленина, д.1"</span><span class="p">,</span>
    <span class="s">"phone"</span><span class="p">:</span> <span class="s">"9268180621"</span><span class="p">,</span>
    <span class="s">"email"</span><span class="p">:</span> <span class="s">"ivan@gmail.com"</span>
  <span class="p">},</span>
  <span class="s">"additional_data"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"previous_url"</span><span class="p">:</span> <span class="s">"https://revo.ru/where-to-buy"</span><span class="p">,</span>
    <span class="s">"channel"</span><span class="p">:</span> <span class="s">"mobile"</span><span class="p">,</span>
    <span class="s">"returning_customer"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"bank_card"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"last_orders"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span>
    <span class="s">"same_address"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>callback_url</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> URL для ответа от Мокка по решению для клиента.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>redirect_url</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> URL для редиректа после нажатия на кнопку/ссылку в форме Мокка &quot;Вернуться в интернет магазин&quot;.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>current_order</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о заказе.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов. Например, можно использовать нумерацию заказов в системе партнёра.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>valid_till</strong><br> <font color="#939da3">String, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Срок, в течении которого заказ считается актуальным (срок холдирования средств). По истечении срока заказ отменяется. Формат: <code>dd.mm.yyyy hh:mm:ss+hh:mm</code>, где после  &quot;+&quot; указывается часовой пояс относительно GMT. По умолчанию - 24 часа.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>term</strong><br> <font color="#939da3">integer, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Срок рассрочки в месяцах.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>amount</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Сумма заказа в рублях.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>prepayment_amount</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Сумма уже внесённой клиентом предоплаты в рублях.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>primary_phone</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>primary_email</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Email клиента.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>person</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>first_name</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Имя клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>surname</strong><br> <font color="#939da3">sring, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Фамилия клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>patronymic</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Отчество клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>birth_date</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Дата рождения клиента в формате <code>dd.mm.yyyy</code>.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>cart_items</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий массив с информацией о заказе.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>sku</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Складская учётная единица (stock keeping unit).</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>name</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Наименование товара.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>price</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Цена товара.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>sale_price</strong><br> <font color="#939da3">float, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Цена товара со скидкой (если есть).</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>quantity</strong><br> <font color="#939da3">integer</font>, <em>optional</em></td>
<td style="text-align: right"></td>
<td style="text-align: left">Количество товара.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>unit</strong><br> <font color="#939da3">string</font>, <em>optional</em></td>
<td style="text-align: right"></td>
<td style="text-align: left">Единица измерения товара. Например, &quot;шт.&quot;, &quot;л.&quot;, &quot;компл.&quot; и т.д.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>brand</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Бренд товара.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>category</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Категория товара.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>skip_result_page</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Флаг, который определяет будет ли отображена страница с результатом оформления в iFrame. По умолчанию - <code>false</code>.<br><code>true</code> - по успешному завершению оформления сразу происходит редирект по <code>redirect_url</code>.<br><code>false</code> - по успешному завершению оформления будет отображено окно с результатом.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>delivery_info</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Объект для передачи массива с дополнительной информацией о заказе, которую клиент вводит на сайте партнёра (не в форме Мокка).</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>first_name</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Имя клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>surname</strong><br> <font color="#939da3">sring, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Фамилия клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>patronymic</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Отчество клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>type</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Способ доставки.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>address</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Адрес доставки.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>phone</strong><br> <font color="#939da3">sring, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>email</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Email клиента.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>additional_data</strong><br> <font color="#939da3">object, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Объект для передачи дополнительной информации о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>previous_url</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Адрес, откуда клиент зашёл на сайт партнёра.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>channel</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">В каком канале открыта форма. Возможные значения: <code>mobile</code>, <code>app</code>, <code>desktop</code>.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>returning_customer</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Является ли клиент повторным для партнёра.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>bank_card</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Является ли последним способом оплаты банковская карта.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>last_orders</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Количество заказов за последние 6 мес.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>same_address</strong><br> <font color="#939da3">bool, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Совпадает ли текущий адрес доставки с предыдущим адресом доставки.</td>
</tr>
</tbody></table>
<h3 id='response-parameters-3'>Response Parameters</h3>
<blockquote>
<p>Пример ответа при успешной аутентификации.</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"iframe_url"</span><span class="p">:</span> <span class="s">"https://revo.ru/factoring/v1/form/6976174c5b6a1bb089d15b80e0a6afc62d4283fe"</span>
<span class="p">}</span>
</code></pre>
<!-- > Пример ответа при неуспешной аутентификации.

```jsonnet
{
  status: 20,
  message: "Order order_id missing",
}
``` -->

<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left">Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Короткое текстовое описание ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>iframe_url</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Cсылка на сгенерированный iFrame.</td>
</tr>
</tbody></table>

<p><a name="callback_url"></a></p>
<h3 id='callback-parameters-2'>Callback parameters</h3>
<blockquote>
<p>Пример callback-а при успешном оформлении товара:</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R107356"</span><span class="p">,</span>
  <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mf">6700.00</span><span class="p">,</span>
  <span class="s">"prepayment_amount"</span><span class="p">:</span> <span class="mf">1000.00</span><span class="p">,</span>
  <span class="s">"total_amount"</span><span class="p">:</span> <span class="mf">7700.00</span><span class="p">,</span>
  <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="s">"client"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"primary_phone"</span><span class="p">:</span> <span class="s">"8880010203"</span>
    <span class="s">"email"</span><span class="p">:</span> <span class="s">"ivan@gmail.com"</span><span class="p">,</span>
    <span class="s">"full_name"</span><span class="p">:</span> <span class="s">"Иванов Иван Иванович"</span><span class="p">,</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="s">"Иван"</span><span class="p">,</span>
    <span class="s">"surname"</span><span class="p">:</span> <span class="s">"Иванов"</span><span class="p">,</span>
    <span class="s">"patronymic"</span><span class="p">:</span> <span class="s">"Иванович"</span>
  <span class="p">},</span>
  <span class="s">"schedule"</span><span class="p">:</span>
  <span class="p">[{</span>
    <span class="s">"date"</span><span class="p">:</span> <span class="s">"01.01.2018"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2933.33</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s">"date"</span><span class="p">:</span> <span class="s">"01.02.2018"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2933.33</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s">"date"</span><span class="p">:</span> <span class="s">"01.03.2018"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2933.33</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Уникальный номер заказа. Не более 255 символов.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>decision</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Решение по выдаче рассрочки. При положительном решении - значение <code>approved</code>. При отрицательном решении - <code>declined</code>.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: left"><td colspan="2"> Сумма к оплате частями в рублях.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>prepayment_amount</strong><br> <font color="#939da3">float, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Сумма предоплаты в рублях.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>total_amount</strong><br> <font color="#939da3">float, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Полная сумма заказа, с учётом предоплаты.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>term</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left"><td colspan="2"> Срок рассрочки в месяцах.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>client</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о клиенте.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>primary_phone</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Номер телефона клиента 10 цифр (без кода страны).</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>primary_email</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Email клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>full_name</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">ФИО через пробел.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>first_name</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Имя клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>surname</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Фамилия клиента.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>patronymic</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Отчество клиента.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>schedule</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о графике платежей.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>date</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Дата платежа в формате <code>dd.mm.yyyy</code>.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Сумма платежа в рублях.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>monthly_overpayment</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: left"><td colspan="2"> Величина ежемесячной переплаты в рублях.</td>
</tr>
</tbody></table>

<aside class="success">
При `decision` равном `declined` значение `amount` будет нулевое, а в `schedule` будет пустой массив.
</aside>
<h2 id='schedule'>Schedule</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">schedule?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод возвращает информацию о доступных графиках платежей для заданной суммы корзины <code>amount</code>. Если для указанной суммы нет ни одного подходящего тарифа, возвращается пустой массив.</p>
<h3 id='parameters-4'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mf">5000.00</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: left">Сумма к оплате частями в рублях.</td>
</tr>
</tbody></table>
<h3 id='response-parameters-4'>Response Parameters</h3>
<blockquote>
<p>Пример ответа, когда доступны два графика платежей: на 3 и 6 месяцев.</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"payment_schedule"</span><span class="p">:</span>
  <span class="p">[{</span>
    <span class="s">"total"</span><span class="p">:</span> <span class="mf">7000.01</span><span class="p">,</span>
    <span class="s">"monthly_payment"</span><span class="p">:</span> <span class="mi">2334</span><span class="p">,</span>
    <span class="s">"monthly_overpayment"</span><span class="p">:</span> <span class="mf">666.67</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s">"payment_dates"</span><span class="p">:</span>
    <span class="p">[{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"11.06.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2334.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"09.07.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2334.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"09.08.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2332.01</span>
    <span class="p">}]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s">"total"</span><span class="p">:</span> <span class="mi">6500</span><span class="p">,</span>
    <span class="s">"monthly_payment"</span><span class="p">:</span> <span class="mi">1100</span><span class="p">,</span>
    <span class="s">"monthly_overpayment"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s">"payment_dates"</span><span class="p">:</span>
    <span class="p">[{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"11.06.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">1100.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"09.07.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">1100.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"09.08.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">1100.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"10.09.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">1100.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"09.10.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">1100.00</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"date"</span><span class="p">:</span> <span class="s">"09.11.2018"</span><span class="p">,</span>
      <span class="s">"amount"</span><span class="p">:</span> <span class="mf">1000.00</span>
    <span class="p">}]</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left"><td colspan="3"> Короткое текстовое описание ответа.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>payment_schedule</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: right"></td>
<td style="text-align: left"><td colspan="3"> Массив объектов, содержащий информацию о предварительных графиках платежей.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>total</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"><td colspan="2" style="text-align:left"> Полная сумма рассрочки с учётом переплаты.</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>monthly_payment</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"><td colspan="2" style="text-align:left"> Приблизительная величина ежемесячного платежа с учётом переплаты.</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>monthly_overpayment</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"><td colspan="2" style="text-align:left"> Величина ежемесячной переплаты в рублях.</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>term</strong><br> <font color="#939da3">int</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"><td colspan="2" style="text-align:left"> Срок рассрочки в месяцах.</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>payment_dates</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"><td colspan="2" style="text-align:left"> Объект, содержащий информацию о графике платежей.</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="3" style="text-align:right"><strong>date</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"></td>
<td style="text-align: left">Дата платежа в формате <code>dd.mm.yyyy</code>.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="3" style="text-align:right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: right"></td>
<td style="text-align: left">Сумма платежа в рублях.</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h2 id='status'>Status</h2><pre class="highlight ruby tab-ruby"><code> <span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">status?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод возвращает информацию по статусу заказа.</p>
<h3 id='parameters-5'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code> <span class="p">{</span>
   <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R107356"</span>
 <span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов.</td>
</tr>
</tbody></table>
<h3 id='response-parameters-5'>Response Parameters</h3>
<blockquote>
<p>Пример ответа, когда клиент прошел до конца оформление в Iframe и ожидает ответа по заказу от Партнера</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"FACTPRECHR00004768"</span><span class="p">,</span>
    <span class="s">"expired"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"hold"</span><span class="p">,</span>
    <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">4999.0</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда клиент прошел до конца оформления в Iframe, но партнер отменил заказ</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"FACTPRECHR00004768"</span><span class="p">,</span>
    <span class="s">"expired"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"canceled"</span><span class="p">,</span>
    <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mi">4999</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда клиент прошел до конца оформления в Iframe, партнер подтвердил заказ.</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"FACTR00004755"</span><span class="p">,</span>
    <span class="s">"expired"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"finished"</span><span class="p">,</span>
    <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда произошел отказ по политикам Мокка</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"FACTPRECHR00004721"</span><span class="p">,</span>
    <span class="s">"expired"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"declined"</span><span class="p">,</span>
    <span class="s">"decision"</span><span class="p">:</span> <span class="s">"declined"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mi">6498</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="kc">null</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда срок холдирования по заявке истёк. Заявка отменена.</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"FACTPRECHR141531"</span><span class="p">,</span>
    <span class="s">"expired"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"expired"</span><span class="p">,</span>
    <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mi">9000</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа, когда клиент успешно прошел оформление в iframe, партнер подтвердил заказ. Был произведен полный возврат.</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"current_order"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"FACTPRECHR00004714"</span><span class="p">,</span>
    <span class="s">"expired"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">"status"</span><span class="p">:</span> <span class="s">"refunded"</span><span class="p">,</span>
    <span class="s">"decision"</span><span class="p">:</span> <span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">734.51</span><span class="p">,</span>
    <span class="s">"term"</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left"><td colspan="2"> Код ответа.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Короткое текстовое описание ответа.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>current_order</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о заказе.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>expired</strong><br> <font color="#939da3">bool</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Флаг, отображающий статус актуальности заказа (холдирования средств). Для актуальных заказов - <code>false</code>. Становится <code>true</code> при наступлении срока <code>valid_till</code>.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>status</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Информация по статусу заказа. Возможные значения:<br> <code>pending</code>, <code>hold</code>, <code>finished</code>, <code>canceled</code>, <code>declined</code>, <code>refunded</code>.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>decision</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Информация по статусу лимита. Если лимит одобрен - <code>approved</code>. Если в лимите отказано - <code>declined</code>.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Сумма, оформленная клиентом для оплаты частями, в рублях.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>term</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Срок рассрочки в месяцах.</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h3 id='status-and-decision-values'>Status and Decision values</h3>
<table><thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: left"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>Decision</strong></td>
<td style="text-align: left"><strong>Status</strong></td>
<td style="text-align: left"><strong>Description</strong></td>
</tr>
<tr>
<td style="text-align: left"><code>null</code></td>
<td style="text-align: left"><code>pending</code></td>
<td style="text-align: left">Клиент не авторизовался в процессе оформления в форме. Решения о лимите не принято.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>pending</code></td>
<td style="text-align: left">Клиент ввел персональные данные и подтвердил номер, но не выбрал срок и не закончил процесс оформления.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>hold</code></td>
<td style="text-align: left">Лимит одобрен, средства захолдированы, ожидается финализация заказа.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>finished</code></td>
<td style="text-align: left">Заказ финализирован. При последующем изменении <code>expired</code>, либо при частичном возврате значение <code>status</code> не поменяется.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>canceled</code></td>
<td style="text-align: left">Заказ отменен. При последующем изменении <code>expired</code> значение <code>status</code> не поменяется.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>expired</code></td>
<td style="text-align: left">Лимит одобрен, срок холдирования по заказу истёк.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>refunded</code></td>
<td style="text-align: left">Был произведен полный возврат средств по заказу. При частичном возврате <code>status</code> останется <code>finished</code>.</td>
</tr>
<tr>
<td style="text-align: left"><code>approved</code></td>
<td style="text-align: left"><code>declined</code></td>
<td style="text-align: left">Лимит одобрен, услуга оплаты частями не доступна клиенту (например, сумма заказа превышает лимит).</td>
</tr>
<tr>
<td style="text-align: left"><code>declined</code></td>
<td style="text-align: left"><code>declined</code></td>
<td style="text-align: left">В лимите отказано по политикам Мокка.</td>
</tr>
</tbody></table>
<h2 id='change'>Change</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">precheck</span><span class="o">/</span><span class="n">change?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод для изменения суммы уже созданного заказа.</p>
<h3 id='parameters-6'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R107356"</span><span class="p">,</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mf">"59999.00"</span><span class="p">,</span>
  <span class="s">"valid_till"</span><span class="p">:</span> <span class="s">"29.07.2018 12:08:01+03:00"</span><span class="p">,</span>
  <span class="s">"cart_items"</span><span class="p">:</span>
  <span class="p">[{</span>
    <span class="s">"sku"</span><span class="p">:</span> <span class="s">"1231"</span><span class="p">,</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Samsung Note 8"</span><span class="p">,</span>
    <span class="s">"price"</span><span class="p">:</span> <span class="mi">55999</span><span class="p">,</span>
    <span class="s">"quantity"</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Уникальный номер заказа. Не более 255 символов.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>amount</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Сумма в рублях.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>valid_till</strong><br> <font color="#939da3">String, <em>optional</em></font></td>
<td style="text-align: left"><td colspan="2"> Срок, в течении которого заказ считается актуальным (срок холдирования средств). По истечении срока заказ отменяется. Формат: <code>dd.mm.yyyy hh:mm:ss+hh:mm</code>, где после  &quot;+&quot; указывается часовой пояс относительно GMT. По умолчанию - 24 часа.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>cart_items</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий массив с информацией о заказе.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>sku</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Складская учётная единица (stock keeping unit).</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>name</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Наименование товара.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>price</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Цена товара.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>sale_price</strong><br> <font color="#939da3">float, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Цена товара со скидкой (если есть).</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>quantity</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Количество товара. Если передано нецелое число, то в форме не отображается.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"> <strong>brand</strong><br> <font color="#939da3">string, <em>optional</em></font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Бренд товара.</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h3 id='response-parameters-6'>Response parameters</h3>
<blockquote>
<p>Пример ответа при успешном изменении заказа:</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span><span class="p">,</span>
  <span class="s">"schedule"</span><span class="p">:</span>
  <span class="p">[{</span>
    <span class="s">"date"</span><span class="p">:</span> <span class="s">"01.01.2018"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2933.33</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s">"date"</span><span class="p">:</span> <span class="s">"01.02.2018"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2933.33</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s">"date"</span><span class="p">:</span> <span class="s">"01.03.2018"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2933.33</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left"><td colspan="2"> Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left"><td colspan="2"> Короткое текстовое описание ответа.</td>
</tr>
<tr>
<td style="text-align: right"></td>
<td style="text-align: right"><strong>schedule</strong><br> <font color="#939da3">object</font></td>
<td style="text-align: left"><td colspan="2"> Объект, содержащий информацию о графике платежей.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>date</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Дата платежа в формате <code>dd.mm.yyyy</code>.</td>
</tr>
<tr>
<td style="text-align: right"><td colspan="2" style="text-align:right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: right"></td>
<td style="text-align: left">Сумма платежа в рублях.</td>
</tr>
</tbody></table>
<h2 id='cancel'>Cancel</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">precheck</span><span class="o">/</span><span class="n">cancel?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод для отмены заказа. При отмене у клиента разблокируются ранее захолдированные средства.</p>
<h3 id='parameters-7'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R107356"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов.</td>
</tr>
</tbody></table>
<h3 id='response-parameters-7'>Response Parameters</h3>
<blockquote>
<p>Пример ответа, когда заявка успешно отменена</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left">Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Короткое текстовое описание ответа.</td>
</tr>
</tbody></table>
<h2 id='finish'>Finish</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">precheck</span><span class="o">/</span><span class="n">finish?store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод для финализации заказа путём передачи договора купли-продажи на обслуживание в Мокка. Запрос должен быть отправлен c типом содержимого <code>multipart/form-data</code>. В запросе должны быть указаны два ключа. Первый ключ с названием <code>body</code>, в котором должно быть указано тело json запроса. Второй ключ с названием <code>check</code>, где прикладывается файл(фискальный документ). <code>Signature</code> формируется по основному принципу, без второго ключа.</p>

<aside class="notice">
При попытке финализации заявки с истекшим сроком `valid_till`, будет вызван метод `cancel`.
</aside>
<h3 id='parameters-8'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R107356"</span><span class="p">,</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mf">6700.00</span><span class="p">,</span>
  <span class="s">"check_number"</span><span class="p">:</span> <span class="s">"ZDDS3123F"</span>
  <span class="s">"check_link"</span><span class="p">:</span> <span class="s">"https://consumer.1-ofd.ru/example_link"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов.</td>
</tr>
<tr>
<td style="text-align: right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: left">Сумма в рублях.</td>
</tr>
<tr>
<td style="text-align: right"><strong>check_number</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Номер фискального документа в системе партнёра (например, номер чека).</td>
</tr>
<tr>
<td style="text-align: right"><strong>check_link</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Ссылка на чек на платформе ОФД</td>
</tr>
</tbody></table>
<h3 id='response-parameters-8'>Response Parameters</h3>
<blockquote>
<p>Пример ответа, когда файл успешно подгружен</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left">Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Короткое текстовое описание ответа.</td>
</tr>
</tbody></table>
<h2 id='return'>Return</h2><pre class="highlight ruby tab-ruby"><code><span class="no">POST</span> <span class="no">BASE_URL</span><span class="o">/</span><span class="n">factoring</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="k">return</span><span class="p">?</span><span class="n">store_id</span><span class="o">=</span><span class="no">STORE_ID</span><span class="o">&amp;</span><span class="n">signature</span><span class="o">=</span><span class="no">SIGNATURE</span>
</code></pre>
<p>Метод для осуществления процедуры полного или частичного возврата заказа. Возвращать можно только уже финализированный заказ. Если заказ ещё не финализирован, вместо возврата его необходимо отменить с помощью метода <a href="#cancel">Cancel</a>. Частичный возврат можно провести не ранее, чем на следующий день после финализации. При возврате средства на счёт клиента зачисляются в полном объёме, включая переплаты, если клиент уже совершал платежи для погашения рассрочки.</p>
<h3 id='parameters-9'>Parameters</h3>
<blockquote>
<p>Пример запроса в формате json</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"order_id"</span><span class="p">:</span> <span class="s">"R001233"</span><span class="p">,</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mf">2010.00</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>order_id</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Уникальный номер заказа. Не более 255 символов.</td>
</tr>
<tr>
<td style="text-align: right"><strong>amount</strong><br> <font color="#939da3">float</font></td>
<td style="text-align: left">Сумма возврата в рублях. Возврат может быть как полным, так и частичным.</td>
</tr>
</tbody></table>
<h3 id='response-parameters-9'>Response Parameters</h3>
<blockquote>
<p>Пример ответа при успешной обработке запроса на возврат</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"Payload valid"</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Пример ответа при неуспешной обработке запроса на возврат</p>
</blockquote>
<pre class="highlight jsonnet tab-jsonnet"><code><span class="p">{</span>
  <span class="s">"status"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s">"message"</span><span class="p">:</span> <span class="s">"JSON decode error"</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: left"></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>status</strong><br> <font color="#939da3">integer</font></td>
<td style="text-align: left">Код ответа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>message</strong><br> <font color="#939da3">string</font></td>
<td style="text-align: left">Короткое текстовое описание ответа.</td>
</tr>
</tbody></table>
<h1 id='cb76858662'>Коды ошибок</h1>
<table><thead>
<tr>
<th style="text-align: right">Код</th>
<th style="text-align: left">Сообщение</th>
<th style="text-align: left">Комментарии</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right"><strong>0</strong></td>
<td style="text-align: left">Payload valid</td>
<td style="text-align: left">Всё ок.</td>
</tr>
<tr>
<td style="text-align: right"><strong>10</strong></td>
<td style="text-align: left">JSON decode error</td>
<td style="text-align: left">Некорректный json запрос.</td>
</tr>
<tr>
<td style="text-align: right"><strong>20</strong></td>
<td style="text-align: left">Order <code>order_id</code> missing</td>
<td style="text-align: left">Не указан <code>order_id</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>21</strong></td>
<td style="text-align: left">Wrong order <code>order_id</code> format</td>
<td style="text-align: left">Неверный формат <code>order_id</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>22</strong></td>
<td style="text-align: left">Order exists</td>
<td style="text-align: left">Заявка с данным <code>order_id</code> уже существует и финалзирована.</td>
</tr>
<tr>
<td style="text-align: right"><strong>23</strong></td>
<td style="text-align: left">Order expired</td>
<td style="text-align: left">У заявки с данным <code>order_id</code> уже истёк холдирования.</td>
</tr>
<tr>
<td style="text-align: right"><strong>24</strong></td>
<td style="text-align: left">Order with specified id not found</td>
<td style="text-align: left">Заявка с указанным <code>order_id</code> не найден.</td>
</tr>
<tr>
<td style="text-align: right"><strong>30</strong></td>
<td style="text-align: left">Wrong order <code>amount</code> format</td>
<td style="text-align: left">Значение <code>amount</code> указано в неверном формате (необходимо указать десятичные знаки).</td>
</tr>
<tr>
<td style="text-align: right"><strong>31</strong></td>
<td style="text-align: left">Wrong order <code>prepayment amount</code> format</td>
<td style="text-align: left">Значение <code>prepayment_amount</code> указано в неверном формате (необходимо указать десятичные знаки).</td>
</tr>
<tr>
<td style="text-align: right"><strong>32</strong></td>
<td style="text-align: left">Order amount is different from the amount specified before</td>
<td style="text-align: left">Указанная при финализации сумма заказа отличается от суммы, на которую совершен заказ. Финализация не осуществлена.</td>
</tr>
<tr>
<td style="text-align: right"><strong>33</strong></td>
<td style="text-align: left">Order amount is outside of tariff_limits</td>
<td style="text-align: left">Сумма заявки не входит в диапазон, установленный в тарифе партнёра. Заявка не создана.</td>
</tr>
<tr>
<td style="text-align: right"><strong>34</strong></td>
<td style="text-align: left">Order term value is wrong</td>
<td style="text-align: left">Указано некорректное значение срока рассрочки <code>term</code> (не существует такого тарифа).</td>
</tr>
<tr>
<td style="text-align: right"><strong>35</strong></td>
<td style="text-align: left">Order prepayment amount is wrong</td>
<td style="text-align: left">Величина <code>prepayment_amount</code> превосходит <code>amount</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>40</strong></td>
<td style="text-align: left">Order <code>callback_url</code> missing</td>
<td style="text-align: left">Не указан <code>callback_url</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>41</strong></td>
<td style="text-align: left">Order <code>redirect_url</code> missing</td>
<td style="text-align: left">Не указан <code>redirect_url</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>50</strong></td>
<td style="text-align: left">Store id is missing</td>
<td style="text-align: left">Не указан <code>store_id</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>51</strong></td>
<td style="text-align: left">Store not found</td>
<td style="text-align: left">Не найден магазин с идентификтором <code>store_id</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>60</strong></td>
<td style="text-align: left"><code>Signature</code> missing</td>
<td style="text-align: left">Не указана цифровая подпись <code>signature</code>.</td>
</tr>
<tr>
<td style="text-align: right"><strong>61</strong></td>
<td style="text-align: left"><code>Signature</code> wrong</td>
<td style="text-align: left">Указанная цифровая подпись <code>signature</code> некорректна.</td>
</tr>
<tr>
<td style="text-align: right"><strong>62</strong></td>
<td style="text-align: left">Error saving file</td>
<td style="text-align: left">Ошибка при сохранении файла.</td>
</tr>
<tr>
<td style="text-align: right"><strong>70</strong></td>
<td style="text-align: left">Phone number is different</td>
<td style="text-align: left">Номер телефона отличается от указанного в заявке.</td>
</tr>
<tr>
<td style="text-align: right"><strong>71</strong></td>
<td style="text-align: left">Client has not enough limit</td>
<td style="text-align: left">У клиента недостаточно средств для осуществления оплаты частями заказа.</td>
</tr>
<tr>
<td style="text-align: right"><strong>80</strong></td>
<td style="text-align: left">Unable to finish - order is already finished/canceled</td>
<td style="text-align: left">Не удаётся финализировать заявку - заявка с указанным <code>order_id</code> уже финализирована или отменена.</td>
</tr>
<tr>
<td style="text-align: right"><strong>81</strong></td>
<td style="text-align: left">Unable to cancel - order is already finished/canceled</td>
<td style="text-align: left">Не удаётся отменить заявку - заявка с указанным <code>order_id</code> уже финализирована или отменена.</td>
</tr>
<tr>
<td style="text-align: right"><strong>82</strong></td>
<td style="text-align: left">Unable to change - order is already finished/canceled</td>
<td style="text-align: left">Не удаётся изменить заявку - заявка с указанным <code>order_id</code> уже финализирована или отменена.</td>
</tr>
<tr>
<td style="text-align: right"><strong>90</strong></td>
<td style="text-align: left">Cart items are missing</td>
<td style="text-align: left">Не удаётся изменить заявку - не передана информация о корзине.</td>
</tr>
<tr>
<td style="text-align: right"><strong>100</strong></td>
<td style="text-align: left">At the moment the server cannot process your request</td>
<td style="text-align: left">Во всех остальных случаях.</td>
</tr>
<tr>
<td style="text-align: right"><strong>110</strong></td>
<td style="text-align: left">Invalid time format value</td>
<td style="text-align: left">Неверный формат срока действия заявки <code>valid_till</code>.</td>
</tr>
</tbody></table>

<p>Тестирование и отладка</p>

<p>Тестирование и отладка интеграции производятся на demo сервере (https://backend.demo.revoup.ru). При заполнении номера телефона в анкете рекомендуется использовать несуществующий префикс оператора 888, чтобы sms сообщения не отправлялись реальным людям. На production сервере использовать такой префикс нельзя.</p>

<p>Все коды подтверждения и пин-коды <code>1111</code>.</p>

<ul>
<li><p>Для получения отказ при использовании <a href="#Registration"><code>Registration</code></a> необходимо указать телефон, начинающийся с 88821.</p></li>
<li><p>Для получения одобрения при использовании <a href="#Registration"><code>Registration</code></a> необходимо указать телефон, начинающийся с 888, кроме 88821.</p></li>
<li><p>Для тестирования на production сервере код задаётся в настройках магазина партнёра. Например, это может быть 7777, вместо 1111.</p></li>
<li><p>В анкете идет проверка по ФИО + дате рождения или номеру паспорта на совпадение с существующим клиентом, поэтому при тестировании необходимо вводить различные данные в эти поля.</p></li>
</ul>
<h1 id='iframe-revo'>Описание iFrame REVO</h1><h2 id='c5a67eacd9'>Регистрация клиента</h2>
<blockquote>
<p><a href="Registration.png" target="new"> <img src="Registration.png"></a></p>
</blockquote>

<p>1-2. Заполнение анкеты.<br>
3. Переход на экран подтверждения номера телефона кодом из смс-сообщения.<br>
3.1 Если клиент допустил ошибку при вводе телефона, то возможен переход на шаг с вводом номера телефона. <br>
4.1 После ввода корректного смс кода происходит отображение окна с результатом &quot;Оформление прошло успешно&quot; и информацией о доступном лимите.<br>
4.2 Либо отображение окна с результатом &quot;К сожалению, &#39;Оплата частями&#39; Вам недоступна&quot;.<br></p>

<p>При вызове iframe Мокка на первом экране (1) отображены поля для ввода персональных данных:</p>

<ul>
<li>Фамилия</li>
<li>Имя</li>
<li>Отчество</li>
<li>Дата Рождения</li>
<li>Номер мобильного телефона</li>
<li>Email</li>
<li>Серия и Номер паспорта</li>
</ul>

<p>Валидация:</p>

<ul>
<li> Фимилия, Имя, Отвество - принимаются данные только в кириллице. Тип данных <code>string</code>.</li>
<li> Дата рождения - задаётся в формате <code>dd.mm.yyyy</code>, тип данных <code>date</code>.</li>
<li> Номер мобильного телефона - необходимо вводить в 10-значном формате, например (888)1231212. Тип данных <code>string</code>.</li>
<li> Email - поле для ввода email, тип данных <code>string</code>.</li>
<li> Серия и номер паспорта - длина должна быть ровно 10 символов, тип данных <code>string</code>.</li>
</ul>

<aside class="notice">
При вызове iframe формы поддерживается возможность автозаполнения полей через тело json запроса.
</aside>
<h2 id='c3d3aac3a6'>Авторизация клиента</h2>
<blockquote>
<p><a href="Authentication.png" target="new"> <img src="Authentication.png"></a></p>
</blockquote>

<ol>
<li>Нажатие кнопки Войти на первой странице формы. <br>
2.1 Ввод мобильного номера и Нажатие кнопки &quot;Отправить СМС&quot;. <br>
2.2 Если мобильный номер не существует в базе Мокка, клиент переходит на окно с информационным сообщением &quot;С указанным номером телефона мы Вас не нашли&quot;. Нажатие на кнопку &quot;Оформить за 1 минуту&quot; приводит к переход на первый шаг формы. <br>
3.1 Если мобильный номер существует в базе Мокка, клиент переходит на экран Подтверждение мобильного номера кодом из смс-сообщения. <br>
3.2 Если клиент допустил ошибку при вводе телефона, то возможен переход на шаг с вводом номера телефона. <br>
4.1 После ввода корректного смс кода происходит отображение окна результата с информацией &quot;Оформление прошло успешно&quot; и информацией о доступном лимите. <br>
4.2 Либо отображение окна результата с информацией &quot;К сожалению, &#39;Оплата частями&#39; Вам недоступна&quot;. <br></li>
</ol>

<!-- ><a href="FAQ.png" target="new"> <img src="FAQ.png" size="50%"></a> -->

<p>По нажатию на кнопку FAQ в правом верхнем углу формы открывается список с ответами на часто задаваемые вопросы.</p>

<aside class="notice">
При авторизации клиента создаётся 30-минутная сессия, в течении которой при повторных обращениях клиенту сразу открывается финальный экран любой формы.
</aside>

<aside class="notice">
Если клиент не завершил оформление в форме по истечении 'valid_till', то будет выдано сообщение об ошибке "К сожалению, время резервирования заказа вышло.".
</aside>
<h2 id='ee363a7d6e'>Оформление покупки</h2>
<blockquote>
<p><a href="Checkout.png" target="new"> <img src="Checkout.png"></a></p>
</blockquote>

<ol>
<li>Заполнение анкеты. <br>
2.1 Переход на экран подтверждения номера телефона кодом из смс-сообщения.<br>
2.2 Если клиент допустил ошибку при вводе телефона, то возможен переход на шаг с вводом номера телефона. <br>
3.1 Если для оформления заказа не требуется предоплата, то идёт переход на экран, где клиенту необходимо выбрать один из возможных для данной суммы заказа периодов оплаты. <br>
3.2 Если для оформления заказа клиенту необходимо внести предоплату, то идёт переход на экран, где клиенту необходимо выбрать один из возможных для данной суммы заказа периодов оплаты, а также указать желаемую величину предоплаты. <br>
4.1 После успешного оформления заказа без предоплаты происходит отображение окна результата с информацией &quot;Оформление прошло успешно&quot; и кнопкой для возврата в магазин. <br>
4.2 Либо отображение окна результата с информацией &quot;К сожалению, &#39;Оплата частями&#39; Вам недоступна&quot;. <br>
4.3 После успешного оформления заказа с предоплатой происходит отображение окна результата с инфомрмацией &quot;Оформление прошло успешно&quot; и кнопкой для перехода к оплате картой. <br>
4.4 Либо отображение окна результата с информацией &quot;К сожалению, &#39;Оплата частями&#39; Вам недоступна&quot;. <br></li>
</ol>
<h1 id='5a291e242a'>Представление на сайте</h1>
<p>Рекомендации по представлению услуги Оплата частями на партёнрском сайте представлены в <a href="REVO Presentation.pdf" target="new">презентации</a>. Ниже приведены инструкции по реализации отдельных элементов Мокка из презентации.</p>
<h2 id='iframe'>Вызов iFrame</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">REVO</span><span class="p">.</span><span class="nx">Form</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">iframe_url</span><span class="p">,</span> <span class="nx">target_selector</span><span class="p">);</span>
</code></pre>
<p>По нажатию на кнопки &quot;Оформить за 1 минуту&quot;, &quot;?&quot; справа от надписи &quot;или 150 Р/мес&quot; и &quot;Оплата&quot; при выбранном способе &quot;Оплата частями&quot; необходимо вызвать iFrame Мокка для регистрации и оформления заказа, соответственно. Для этого нужно получить с помощью метода <a href="#Registration"><code>Registration</code></a> или <a href="#Checkout"><code>Checkout</code></a> ссылку на iFrame и передать её в js метод плагина REVO.</p>

<p><code>iframe_url</code> – адрес открываемого iFrame, обязательный параметр.
<code>target_selector</code> – селектор элемента, внутрь которого должен быть вставлен iFrame.</p>

<p>Далее работает предоставленный Мокка плагин js (реализован в виде модуля REVO), который вставляет <code>&lt;iframe src= iframe_url /&gt;</code> и производит манипуляции с этим iFrame.</p>

<p>Плагин доступен по адресу: <code>https://{BASE_URI}/javascripts/iframe/v2/revoiframe.js</code> и его можно добавить на страницу интернет магазина.</p>
<pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://{BASE_URI}/javascripts/iframe/v2/revoiframe.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
<p>Также данный плагин предоставляет возможность получения событий: закрытия формы - <code>onClose</code>, загрузки формы - <code>onLoad</code> и принятия решения по заявке - <code>onResult</code>.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">REVO</span><span class="p">.</span><span class="nx">Form</span><span class="p">.</span><span class="nx">onClose</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">'closed'</span><span class="p">);</span> <span class="p">});</span>
<span class="nx">REVO</span><span class="p">.</span><span class="nx">Form</span><span class="p">.</span><span class="nx">onLoad</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'frame loaded'</span><span class="p">);</span> <span class="p">});</span>
<span class="nx">REVO</span><span class="p">.</span><span class="nx">Form</span><span class="p">.</span><span class="nx">onResult</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'result'</span><span class="p">);</span> <span class="p">});</span>
</code></pre>
<aside class="success">
При необходимости отобразить iFrame на отдельной странице следует напрямую открывать `iframe_url`. Настройка фона этой страницы производится на стороне Мокка.
</aside>
<h2 id='818f499a59'>Отображение доступного лимита</h2>
<p>Если клиент уже прошёл регистрацию и получил лимит, то доступные ему для Оплаты частями средства можно отображать с помощью метода <a href="#limit">Limit</a>.</p>
<h1 id='db947828e5'>Тестирование и отладка</h1><h2 id='afed7bf690'>Тестовые Параметры</h2>
<p>Тестовые мобильные номера для ввода в <a href="#iframe-revo">iframe</a>:</p>

<p><code>8881ХХХХXX</code> - одобрено всё (второе оформление = повторная заявка)</p>

<p><code>88821ХХХХХ</code> - отказано полностью</p>

<p><code>88822ХХХХХ</code> - одобрены только займ</p>

<p>Код для подтверждения номера телефона - <code>1111</code></p>

<aside class="notice">
Данные параметры предназначены только для demo сервиса.
</aside>
<h2 id='16d7f57449'>Инструкции для тестирования</h2><h3 id='41a57c96e5'>Подробное описание вызова формы для регистрации клиента.</h3>
<blockquote>
<p>Пример формирования signature на ruby:</p>
</blockquote>
<pre class="highlight ruby tab-ruby--tab"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"callback_url"</span><span class="p">:</span> <span class="s2">"https://shop.ru/revo/decision"</span><span class="p">,</span>
<span class="s2">"redirect_url"</span><span class="p">:</span> <span class="s2">"https://shop.ru/revo/redirect"</span><span class="p">,</span>
<span class="s2">"primary_phone"</span><span class="p">:</span> <span class="s2">"9268180621"</span><span class="p">,</span>
<span class="s2">"primary_email"</span><span class="p">:</span> <span class="s2">"ivan@gmail.com"</span><span class="p">,</span>
<span class="s2">"current_order"</span><span class="p">:</span>
<span class="p">{</span>
 <span class="s2">"order_id"</span><span class="p">:</span> <span class="s2">"R001233"</span>
<span class="p">}}</span>
 <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:callback_url</span><span class="o">=&gt;</span><span class="s2">"https://shop.ru/revo/decision"</span><span class="p">,</span> <span class="ss">:redirect_url</span><span class="o">=&gt;</span><span class="s2">"https://shop.ru/revo/redirect"</span><span class="p">,</span> <span class="ss">:primary_phone</span><span class="o">=&gt;</span><span class="s2">"9268180621"</span><span class="p">,</span> <span class="ss">:primary_email</span><span class="o">=&gt;</span><span class="s2">"ivan@gmail.com"</span><span class="p">,</span> <span class="ss">:current_order</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:order_id</span><span class="o">=&gt;</span><span class="s2">"R001233"</span><span class="p">}}</span>

 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">to_json</span>
 <span class="o">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">callback_url</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">https://shop.ru/revo/decision</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">redirect_url</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">https://shop.ru/revo/redirect</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">primary_phone</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">9268180621</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">primary_email</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">ivan@gmail.com</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">current_order</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">order_id</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">R001233</span><span class="se">\"</span><span class="s2">}}"</span>

 <span class="n">secret_key</span> <span class="o">=</span> <span class="s2">"9fff8c602b08b00323567be0001480f6"</span>

 <span class="n">signature</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">SHA1</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">secret_key</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">"347e8cff27d30b5200c8b32def4365ebbf4270d0"</span>

<span class="nb">puts</span> <span class="n">data</span>
<span class="p">{</span><span class="s2">"callback_url"</span><span class="ss">:"https://shop.ru/revo/decision"</span><span class="p">,</span><span class="s2">"redirect_url"</span><span class="ss">:"https://shop.ru/revo/redirect"</span><span class="p">,</span><span class="s2">"primary_phone"</span><span class="ss">:"9268180621"</span><span class="p">,</span><span class="s2">"primary_email"</span><span class="ss">:"ivan@gmail.com"</span><span class="p">,</span><span class="s2">"current_order"</span><span class="p">:{</span><span class="s2">"order_id"</span><span class="ss">:"R001233"</span><span class="p">}}</span>

</code></pre>
<p>Для вызова формы используется метод <a href="#registration">registration</a>.</p>

<blockquote>
<p>Пример отправки запроса через API CLIENT:</p>

<p><a href="rest_client.png" target="new"> <img src="rest_client.png"></a></p>
</blockquote>

<p>Необходимые параметры для вызова формы:</p>

<ul>
<li>базовый URL сервиса для тестирования и отладки</li>
<li>store_id</li>
<li>signature</li>
</ul>

<p>Описание формирования запроса на получение ссылки вызова iframe:</p>

<ul>
<li>В переменную <code>data</code> вводится тело json запроса</li>
<li>Переводим <code>data</code> в <code>json</code> формат</li>
<li>В переменную <code>secret_key</code> вводим наименование ключа</li>
<li>В переменную <code>signature</code> формируем подпись</li>
<li>Выводим тело <code>json</code> запроса через команду <code>puts</code> для отправки запроса через клиент</li>
</ul>

<p>Данные для отправки запроса в REST CLIENT:</p>

<p>Используется POST URL:
<code>https://backend.demo.revoup.ru/factoring/v1/limit/auth?store_id=72&amp;signature=347e8cff27d30b5200c8b32def4365ebbf4270d0</code></p>

<p>Тело JSON:
<code>{&quot;callback_url&quot;:&quot;https://shop.ru/revo/decision&quot;,&quot;redirect_url&quot;:&quot;https://shop.ru/revo/redirect&quot;,&quot;primary_phone&quot;:&quot;9268180621&quot;,&quot;primary_email&quot;:&quot;ivan@gmail.com&quot;,&quot;current_order&quot;:{&quot;order_id&quot;:&quot;R001233&quot;}}</code></p>
<h3 id='74e834851b'>Подробное описание отправки запроса на финализацию заказа</h3>
<blockquote>
<p>Пример формирования signature на ruby:</p>
</blockquote>
<pre class="highlight ruby tab-ruby--tab"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="ss">order_id: </span><span class="s2">"FACTPRECHR00005384"</span><span class="p">,</span> <span class="ss">amount: </span><span class="mi">4999</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="ss">check_number: </span><span class="s2">"sdfhk"</span><span class="p">}</span>
 <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:order_id</span><span class="o">=&gt;</span><span class="s2">"FACTPRECHR00005384"</span><span class="p">,</span> <span class="ss">:amount</span><span class="o">=&gt;</span><span class="mi">4999</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="ss">:check_number</span><span class="o">=&gt;</span><span class="s2">"sdfhk"</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">to_json</span>
 <span class="o">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">order_id</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">FACTPRECHR00005384</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">amount</span><span class="se">\"</span><span class="s2">:4999.0,</span><span class="se">\"</span><span class="s2">check_number</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">sdfhk</span><span class="se">\"</span><span class="s2">}"</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="s2">"9fff8c602b08b00323567be0001480f6"</span>
 <span class="o">=&gt;</span> <span class="s2">"9fff8c602b08b00323567be0001480f6"</span>
<span class="n">signature</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">SHA1</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">secret_key</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">"70189f8a4f413fcb01c8933cae50f4341fe8fdee"</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span> <span class="p">:</span><span class="mo">012</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">data</span>
<span class="p">{</span><span class="s2">"order_id"</span><span class="ss">:"FACTPRECHR00005384"</span><span class="p">,</span><span class="s2">"amount"</span><span class="p">:</span><span class="mi">4999</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="s2">"check_number"</span><span class="ss">:"sdfhk"</span><span class="p">}</span>

</code></pre>
<blockquote>
<p>Пример запроса через REST клиент POSTMAN:</p>

<p><a href="post_finish.png" target="new"> <img src="post_finish.png"></a></p>
</blockquote>

<p>Для финализации заказа используется метод <a href="#finish">finish</a></p>

<p>Необходимые параметры для финализации заказа:</p>

<ul>
<li>базовый URL для тестирования и отладки</li>
<li>store_id</li>
<li>signature</li>
</ul>

<p>Описание формирования запрос на финализацию заказа:</p>

<ul>
<li>В переменную <code>data</code> вводится тело json запроса</li>
<li>Переводим   <code>data</code> в <code>json</code> формат</li>
<li>В переменную <code>secret_key</code> вводим наименование ключа</li>
<li>В переменную  <code>signature</code> формируем подпись</li>
<li>Выводим тело <code>json</code> запроса через команду <code>puts</code> для отправки запроса через клиент</li>
</ul>

<p>Данные для отправки запроса в REST CLIENT:</p>

<p>Используется POST URL:
<code>https://backend.demo.revoup.ru/factoring/v1/precheck/finish?store_id=72&amp;signature=70189f8a4f413fcb01c8933cae50f4341fe8fdee</code></p>

<p>Тело JSON с key = body:
<code>{&quot;order_id&quot;:&quot;FACTPRECHR00005384&quot;,&quot;amount&quot;:4999.0,&quot;check_number&quot;:&quot;sdfhk&quot;}</code></p>

<p>Приложение фискального документа с key = check.</p>
<h2 id='b7617b8769'>Кейсы для тестирования</h2>
<aside class="warning">
Раздел в разработке.
</aside>
<h3 id='1'>1. Новый клиент проходит форму регистрации и получает одобрение</h3>
<table><thead>
<tr>
<th style="text-align: left">Шаги</th>
<th style="text-align: left">Ожидаемый результат</th>
<th style="text-align: left">Статус по заявке</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Отправить запрос с помощью метода <a href="#registration">auth</a></td>
<td style="text-align: left">Получить ссылку на вызов iframe</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Вызов iframe_url</td>
<td style="text-align: left">Отображение <a href="#ee363a7d6e">iframe формы</a> с вводом персональных данных</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Ввод несуществующих в базе данных и нажатие кнопки «Оформить»</td>
<td style="text-align: left">Переход на этап подтверждения СМС-кодом</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Нажатие на кнопку «Подтвердить»</td>
<td style="text-align: left">Отображение экрана результата с информацией об одобренном лимите</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h3 id='2'>2. Новый клиент проходит форму регистрации и получает отказ</h3>
<table><thead>
<tr>
<th style="text-align: left">Шаги</th>
<th style="text-align: left">Ожидаемый результат</th>
<th style="text-align: left">Статус по заявке</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Отправить запрос с помощью метода <a href="#registration">auth</a></td>
<td style="text-align: left">Получить ссылку на вызов iframe</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Вызов iframe_url</td>
<td style="text-align: left">Отображение <a href="#ee363a7d6e">iframe формы</a> с вводом персональных данных</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Ввод несуществующих в базе данных и нажатие кнопки «Оформить»</td>
<td style="text-align: left">Переход на этап подтверждения СМС-кодом</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Нажатие на кнопку «Подтвердить»</td>
<td style="text-align: left">Отображение экрана результата с информацией о недоступности услуги оплаты частями</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h3 id='3'>3. Новый клиент в момент прохождения формы регистрации меняет номер на несуществующий в базе и получает решение</h3>
<table><thead>
<tr>
<th style="text-align: left">Шаги</th>
<th style="text-align: left">Ожидаемый результат</th>
<th style="text-align: left">Статус по заявке</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Отправить запрос с помощью метода <a href="#registration">auth</a></td>
<td style="text-align: left">Получить ссылку на вызов iframe</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Вызов iframe_url</td>
<td style="text-align: left">Отображение <a href="#ee363a7d6e">iframe формы</a> с вводом персональных данных</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Ввод несуществующих в базе данных и нажатие кнопки «Оформить»</td>
<td style="text-align: left">Переход на этап подтверждения СМС-кодом</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Нажатие кнопки изменения номера на экране подтверждения СМС-кодом</td>
<td style="text-align: left">Переход на этап ввода номера телефона</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Ввод несуществующего в базе номера и нажатие кнопки «Отправить SMS»</td>
<td style="text-align: left">Переход на этап подтвержения СМС-кодом</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Ввод кода подтверждения</td>
<td style="text-align: left">Отображение экрана результата с информацией о решении</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h2 id='ad57058c12'>Особенности</h2>
<blockquote>
<p>Кейс 1</p>

<p><a href="approve.png" target="new"> <img src="approve.png"></a><a href="declined_fio_dr.png" target="new"> <img src="declined_fio_dr.png"></a></p>
</blockquote>
<h3 id='iframe-2'>Логика взаимодействия ввода персональных данных при оформлении заказа в iframe</h3>
<p>Кейс 1:</p>

<ul>
<li>Ввод в анкету существующего в базе Мокка ФИО + Дата рождения или Паспортные данные + Номер телефона, который не существует в базе Мокка.</li>
</ul>

<p>Что происходит:</p>

<ul>
<li>Клиента переводит на окно с подтверждением кода из смс. Если клиент подтверждает код из смс, то происходит переход на окно с результатом. В результате отображается информационное сообщение о необходимости подтверждения данных клиента.</li>
</ul>

<p>Кейс 2:</p>

<ul>
<li>Ввод существующего номера телефона и фио клиента. Ввод паспортных данных и даты рождения не соответствует данным клиента.</li>
</ul>

<p>Что происходит:</p>

<ul>
<li>Клиента переводит на окно подтверждения кода из смс. Если клиент подтверждает код из смс, то происходит переход на окно с корзиной и графиком платежей. Далее переход на окно с результатом, где отображается информационное сообщение об успешном оформлении. (Подробнее в описание <a href="#ee363a7d6e"> Оформление покупки</a>)</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="ruby--tab">Ruby</a>
                <a href="#" data-language-name="java">Java</a>
          </div>
      </div>
    </div>
  </body>
</html>
